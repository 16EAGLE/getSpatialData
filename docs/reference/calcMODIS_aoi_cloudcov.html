<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate the cloud cover of MODIS data within an aoi — calcMODIS_aoi_cloudcov • getSpatialData</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Calculate the cloud cover of MODIS data within an aoi — calcMODIS_aoi_cloudcov" />

<meta property="og:description" content="calcMODIS_aoi_cloudcov estimates the cloud cover of Landsat data based on preview images using the haze-optimal transformation (HOT)" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">getSpatialData</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Get Started
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../index.html#sentinel-query-preview-and-download">Sentinel query, preview and download</a>
    </li>
    <li>
      <a href="../index.html#parallelized-download-of-modis-data-user-example">Parallelized download of MODIS data (user example)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="http://www.github.com/bleutner/RStoolbox">RStoolbox</a>
    </li>
    <li>
      <a href="http://www.github.com/RRemelgado/rsmove">rsMove</a>
    </li>
    <li>
      <a href="http://movevis.org">moveVis</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://www.twitter.com/schwalbwillmann">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://www.github.com/16eagle">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://remote-sensing.eu">
    <span class="fa fa-globe fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate the cloud cover of MODIS data within an aoi</h1>
    
    <div class="hidden name"><code>calcMODIS_aoi_cloudcov.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p><code>calcMODIS_aoi_cloudcov</code> estimates the cloud cover of Landsat data based on preview images using the haze-optimal transformation (HOT)</p>
    
    </div>

    <pre class="usage"><span class='fu'>calcMODIS_aoi_cloudcov</span>(<span class='no'>records</span>, <span class='kw'>aoi</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>maxDeviation</span> <span class='kw'>=</span> <span class='fl'>20</span>,
  <span class='kw'>cloudPrbThreshold</span> <span class='kw'>=</span> <span class='fl'>40</span>, <span class='kw'>slopeDefault</span> <span class='kw'>=</span> <span class='fl'>1.4</span>, <span class='kw'>interceptDefault</span> <span class='kw'>=</span> -<span class='fl'>10</span>,
  <span class='kw'>dir_out</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>username</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>password</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>records</th>
      <td><p>data.frame, one or multiple records (each represented by one row), as it is returned by <a href='getSentinel_query.html'>getSentinel_query</a>.</p></td>
    </tr>
    <tr>
      <th>aoi</th>
      <td><p>sfc_POLYGON or SpatialPolygons or matrix, representing a single multi-point (at least three points) polygon of your area-of-interest (AOI). If it is a matrix, it has to have two columns (longitude and latitude) and at least three rows (each row representing one corner coordinate). If its projection is not <code>+proj=longlat +datum=WGS84 +no_defs</code>, it is reprojected to the latter. Use <a href='gSD_settings.html'>set_aoi</a> instead to once define an AOI globally for all queries within the running session. If <code>aoi</code> is undefined, the AOI that has been set using <a href='gSD_settings.html'>set_aoi</a> is used.</p></td>
    </tr>
    <tr>
      <th>maxDeviation</th>
      <td><p>numeric, the maximum allowed deviation of calculated scene cloud cover from the provided scene cloud cover. Use 100 if you do not like to consider the cloud cover % given by the data distributor. Default is <code>maxDeviation = 20</code>.</p></td>
    </tr>
    <tr>
      <th>cloudPrbThreshold</th>
      <td><p>numeric, the threshold of the HOT cloud probability layer (0-100 %) below which pixels are considered as clear sky. Default is <code>cloudPrbThreshold = 40</code>. It will be dynamically adjusted according to the input in <code>maxDeviation</code>.</p></td>
    </tr>
    <tr>
      <th>slopeDefault</th>
      <td><p>numeric, value taken as slope ONLY if least-alternate deviation regression fails.  Default is 1.4, proven to work well for common land surfaces.f default values. In this case cloud cover will be set to 9999 % for the given record.</p></td>
    </tr>
    <tr>
      <th>interceptDefault</th>
      <td><p>numeric, value taken as intercept ONLY if least-alternate deviation regression fails. Default is -10, proven to work well for common land surfaces.</p></td>
    </tr>
    <tr>
      <th>dir_out</th>
      <td><p>character, optional. Full path to target directory where to save the cloud masks. If <code>NULL</code>, cloud masks are not saved.</p></td>
    </tr>
    <tr>
      <th>username</th>
      <td><p>character, a valid user name to the ESA Copernicus Open Access Hub. If <code>NULL</code> (default), the session-wide login credentials are used (see <a href='gSD_login.html'>login_CopHub</a> for details on registration).</p></td>
    </tr>
    <tr>
      <th>password</th>
      <td><p>character, the password to the specified user account. If <code>NULL</code> (default) and no seesion-wide password is defined, it is asked interactively ((see <a href='gSD_login.html'>login_CopHub</a> for details on registration).</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical, if <code>TRUE</code>, details on the function's progress will be visibile on the console. Default is TRUE.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data.frame as the records input with one additional column holding the estimated cloud cover within the aoi</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Cloud cover of optical remote sensing data is normally provided scene-wide by the data dissiminator. This function uses HOT in order to derive a local cloud cover % within an aoi. The estimation of the cloud cover is done on the red and blue information of the preview images provided by the respective data dissiminator.
Haze-optimal transformation (HOT) procedure is applied based on 
Zhu &amp; Helmer (2018), https://data.fs.usda.gov/research/pubs/iitf/ja_iitf_2018_Zhu.pdf. Orignally, the algorithm was introduced by Zhang et al. (2002)
"An image transform to characterize and compensate for spatial variations in thin cloud contamination of Landsat images", Remote Sensing of Environment 82, 2-3.
HOT seperates clear-sky pixels first from a threshold, calculates a least alternate deviation (LAD) regression from these pixels and exposes cloud pixels by the deviation of all pixels from this clear-sky line.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='calc_hot_cloudcov.html'>calc_hot_cloudcov</a>, <a href='getMODIS_query.html'>getMODIS_query</a>, <a href='getMODIS_preview.html'>getMODIS_preview</a>, <a href='getMODIS_data.html'>getMODIS_data</a></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'>## Load packages</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>getSpatialData</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>sf</span>)

<span class='co'>## set aoi and time range for the query</span>
<span class='fu'><a href='gSD_settings.html'>set_aoi</a></span>(<span class='no'>aoi_data</span><span class='kw'>[[</span><span class='fl'>1</span>]])
<span class='no'>time_range</span> <span class='kw'>&lt;-</span>  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"2017-08-01"</span>, <span class='st'>"2017-08-30"</span>)

<span class='co'>## Login to USGS ERS</span>
<span class='co'># }</span><span class='co'># NOT RUN {</span>
<span class='fu'><a href='gSD_login.html'>login_USGS</a></span>(<span class='st'>"username"</span>)

<span class='co'>## set archive directory</span>
<span class='fu'><a href='gSD_settings.html'>set_archive</a></span>(<span class='st'>"/path/to/archive/"</span>)

<span class='co'>## get available products and select one</span>
<span class='no'>product_names</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='getMODIS_names.html'>getMODIS_names</a></span>()
<span class='no'>product</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/grep'>grep</a></span>(<span class='st'>"MOD13Q1"</span>, <span class='no'>product_names</span>, <span class='kw'>value</span> <span class='kw'>=</span> <span class='no'>T</span>)

<span class='co'>## query for records for your AOI, time range and product</span>
<span class='no'>records</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='getMODIS_query.html'>getMODIS_query</a></span>(<span class='kw'>time_range</span> <span class='kw'>=</span> <span class='no'>time_range</span>, <span class='kw'>name</span> <span class='kw'>=</span> <span class='no'>product</span>)

<span class='co'>## Calculate cloud cover within the aoi</span>
<span class='no'>records_cloudcov</span> <span class='kw'>&lt;-</span> <span class='fu'>calcMODIS_aoi_cloudcov</span>(<span class='kw'>records</span> <span class='kw'>=</span> <span class='no'>records</span>, <span class='kw'>aoi</span> <span class='kw'>=</span> <span class='no'>aoi</span>) <span class='co'># cloud cov. calc.</span>

<span class='co'>## preview a record</span>
<span class='fu'><a href='getMODIS_preview.html'>getMODIS_preview</a></span>(<span class='no'>records_cloudcov</span>[<span class='fl'>1</span>,])

<span class='co'>## download records 1 and 2</span>
<span class='no'>files</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='getMODIS_data.html'>getMODIS_data</a></span>(<span class='no'>records_cloudcov</span>[<span class='fl'>1</span>:<span class='fl'>2</span>,])
<span class='co'># }</span># NOT RUN {
# }
</pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Henrik Fisser</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Jakob Schwalb-Willmann.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

